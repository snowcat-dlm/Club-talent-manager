{% extends 'base.html' %}
{% block title %}è‡ªåˆ†ã®æ¸¬å®šè¨˜éŒ²ä¸€è¦§{% endblock %}
{% load django_bootstrap5 %}
{% load static %}
{% block content %}
<div class="container mt-4">
  <h2>è‡ªåˆ†ã®æ¸¬å®šè¨˜éŒ²ä¸€è¦§</h2>

  {% if records %}
    {% for record in records %}
      <div class="card mb-4">
        <div class="card-header">
          æ¸¬å®šæ—¥: {{ record.measured_at }}
          <span class="badge bg-secondary float-end">{{ record.get_status_display }}</span>
        </div>

        <div class="card-body">
          <h5>æ¸¬å®šé …ç›®</h5>
          <ul>
            {% for item in record.items.all %}
              <li>{{ item.category }} / {{ item.item_name }}: {{ item.value }} {{ item.unit }}</li>
            {% empty %}
              <li>æ¸¬å®šé …ç›®ãªã—</li>
            {% endfor %}
          </ul>

          <hr>

          {% for approval in record.approvalstatus_set.all %}
            {% if approval.role == 'player' and approval.approver == user %}
                {% if approval.status == 'pending' %}
                <div class="mt-3">
                    <form method="post" action="{% url 'approve_measurement_record' record.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary me-2">ğŸ”˜ æ‰¿èªã™ã‚‹</button>
                    </form>
                    <a href="{% url 'reject_measurement_record' record.id %}" class="btn btn-outline-danger">âŒ å¦èªã™ã‚‹</a>
                </div>
                {% elif approval.status == 'approved' %}
                <p class="text-success mt-2">âœ… æ‰¿èªæ¸ˆã¿ï¼ˆ{{ approval.approved_at|date:"Y-m-d H:i" }}ï¼‰</p>
                {% elif approval.status == 'rejected' %}
                <p class="text-danger mt-2">âŒ å¦èªæ¸ˆã¿ï¼ˆ{{ approval.approved_at|date:"Y-m-d H:i" }}ï¼‰<br>
                ç†ç”±ï¼š{{ approval.comment|default:"æœªå…¥åŠ›" }}</p>
                {% endif %}
            {% endif %}
            {% endfor %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>ã¾ã æ¸¬å®šè¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  {% endif %}
</div>
{% endblock %}
